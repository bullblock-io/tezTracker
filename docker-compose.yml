version: "3.1"

services:
  conseil-lorre:
    build:
      context: .
      dockerfile: Dockerfile-conseil
    command: lorre
    environment:
      DB_Host: "${DB_HOST}"
      DB_User: "${DB_USER}"
      DB_Password: "${DB_PASSWORD}"
      DB_Database: "${DB_DATABASE}"
      XTZ_Host: "${XTZ_HOST}"
    # If using localhost db you may want to use the host network
    network_mode: "host"
    restart: on-failure
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
  fe-server:
    build:
      context: https://github.com/bullblock-io/tezos-tracker-vue.git
    ports:
      - "8080:8080"
    restart: on-failure
    deploy:
      restart_policy:
        condition: on-failure
  api-server:
    build: .
    ports:
      - ${TEZTRACKER_PORT}:${TEZTRACKER_PORT}
    environment:
      TEZTRACKER_PORT: ${TEZTRACKER_PORT}
      TEZTRACKER_SQL_CONNECTION_STRING: ${TEZTRACKER_SQL_CONNECTION_STRING}
      TEZTRACKER_LOG_LEVEL: ${TEZTRACKER_LOG_LEVEL}
    # If using localhost db you may want to use the host network
    network_mode: "host"
    restart: on-failure
    deploy:
      restart_policy:
        condition: on-failure
